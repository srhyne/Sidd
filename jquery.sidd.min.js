(function($){var url={search:"/search.json?query=",forums:"/forums",entries:"/entries"},entryKeys=[],getEntries=function(opts,callback){var _this=this,zendesk_data={forums:{},entries:[]},forumsUrl=opts.url+url.forums,forum_left=0,json=".json?callback=?",get=function(url){return $.getJSON(url);},processForumList=function(data){var l=data.reverse().length,f,_forums=zendesk_data.forums,forumEntries;forum_left=l;while(l--){f=data[l];_forums[f.id]=f.name;forumEntries=get(forumsUrl+"/"+f.id+url.entries+json);forumEntries.success(processForumEntries);}
opts=$.extend(opts,{data:zendesk_data});$.data(_this[0],'sidd',opts);},processForumEntries=function(data){var l=data.reverse().length,e,_entries=zendesk_data.entries;forum_left-=1;while(l--){e=data[l];e.current_tags=(e.current_tags||"").split(" ");_entries.push(e);}
forum_left===0&&typeof callback==="function"&&callback.call(_this,zendesk_data);},forumList=get(forumsUrl+json);forumList.success(processForumList);},filter={dom_tag:function(data,key,id){data.dom_tags=[];data.filtered=$.grep(data.filtered,function(el,i){$.each(el.current_tags,function(i,tag){if(tag.indexOf(id)===0){tag=tag.replace("_","#");el.dom_tags=el.dom_tags||[];el.dom_tags.push(tag);data.dom_tags.indexOf(tag)===-1&&data.dom_tags.push(tag);}});return el.hasOwnProperty('dom_tags');});},current_tags:function(data,key,tags){data.filtered=$.grep(data.filtered,function(el,i){var l=tags.length;$.each(tags,function(i,v){el[key].indexOf(v)!==-1&&l--;});return l===0;});},body:function(data,key,text){data.filtered=$.grep(data.filtered,function(el,i){return el[key].indexOf(text)!==-1;});},byKey:function(data,key,value){data.filtered=$.grep(data.filtered,function(el,i){return el[key]===value;});}},methods={init:function(customOpts,callback){var _this=this,defaultOpts={state:0},opts=$.extend(defaultOpts,customOpts,true);if(!opts.hasOwnProperty("url")){return $.error("No zendesk support url supplied");}
$.data(this[0],"sidd",opts);if(opts.hasOwnProperty("data")&&typeof callback==="function"){callback.call(this,opts.data);}
else{getEntries.call(this,opts,callback);}
return this;},data:function(customOpts,raw){var opts=customOpts||{},sidd=$.data(this[0],"sidd"),data=sidd.data;if(!data.entries){$.error("Forum or entries data missing.");return this;}
if(entryKeys.length===0){$.each(data.entries[0],function(k,v){entryKeys.push(k);});entryKeys.push("dom_tag");}
data.filtered=data.entries.slice(0);$.each(entryKeys,function(filterIndex,filterKey){if(opts.hasOwnProperty(filterKey)){var method=filter.hasOwnProperty(filterKey)?filterKey:"byKey";filter[method](data,filterKey,opts[filterKey]);}});return raw?sidd:data;},get:function(customOpts,callback){var opts=methods.data.call(this,customOpts,true),zendesk_data=opts.data;typeof callback==="function"&&callback.call(this,zendesk_data);return this;},showMenus:function(customOpts){var opts=$.extend({dom_tag:"_",menu:$("<div/>",{"class":"sidd-menu"})},customOpts,true),data=$.data(this[0],"sidd"),_this=this,current_stack=$([]);methods.get.call(this,opts,function(zendesk_data){var menu=opts.menu;$.each(zendesk_data.dom_tags,function(index,selector){var anchor=_this.find("#"+selector+":visible").eq(0),offset,_tip,forumCheck={},_menu,entries;if(anchor[0]){offset=anchor.offset();_menu=menu.clone().css({top:offset.top+30,left:offset.left+0});entries=$.grep(zendesk_data.filtered,function(obj){return obj.dom_tags.indexOf(selector)!==-1;});entries.sort(function(a,b){a.forum_id-b.forum_id;});$.each(entries,function(key,entry){if(!forumCheck[entry.forum_id])
$("<h1/>",{className:"sidd-forum-title",text:zendesk_data.forums[entry.forum_id]}).appendTo(_menu);$("<p/>",{html:$("<a/>",{target:"_blank",href:data.url+url.entries+"/"+entry.id,html:entry.title+" Â»"})}).appendTo(_menu);});current_stack=current_stack.add(_menu);_menu.appendTo("body").addClass("visible");}});});data.state=1;data.current_stack=current_stack;return this;},removeMenus:function(customOpts){var data=$.data(this[0],"sidd");data.state=0;data.current_stack&&data.current_stack.remove();return this;},toggleMenus:function(customOpts){var state=$.data(this[0],"sidd").state,_event=state===0?"showMenus":"removeMenus";methods[_event].call(this,customOpts);return this;},methods:function(){var _methods=[];$.each(methods,function(k){_methods.push(k);});return _methods;},json:function(){var data=methods.data.call(this,{});delete data.filtered;return window.JSON?JSON.stringify(data):$.error("window.JSON not supported\nhttps://github.com/douglascrockford/JSON-js");}};$.fn.sidd=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}
return $.error('Method '+method+' does not exist on jQuery.sidd');};})(jQuery);